# Obsidian Local GPT 用户指南

## 插件简介

Obsidian Local GPT 是一个强大的 Obsidian 插件，允许您直接在笔记中使用各种 AI 模型，包括本地运行的模型（如 Ollama）和兼容 OpenAI API 的服务。插件支持文本生成、上下文增强、图像识别等功能，并提供了灵活的提示词模板系统。

## 主要特性

- **多模型支持**：支持配置多种 AI 提供商，包括 Ollama、OpenAI 及兼容 OpenAI API 的服务
- **模型自动切换**：当检测到图片时，自动切换到支持视觉功能的模型
- **提示词模板**：丰富的提示词模板系统，支持各种变量和条件控制
- **上下文增强**：自动提取链接文档内容，增强 AI 的上下文理解
- **性能监控**：显示 Token 使用量和响应时间等性能指标
- **输出格式控制**：控制模型信息和性能数据的显示
- **自定义动作**：创建和分享自定义 AI 动作

## 设置说明

### 基本设置

1. **主 AI 提供商**：选择默认使用的 AI 提供商
2. **嵌入 AI 提供商**：用于增强上下文的嵌入模型（可选）
3. **视觉 AI 提供商**：用于处理图像的视觉模型（可选，如未设置则尝试使用主模型）
4. **创造力级别**：控制模型的温度参数（None、Low、Medium、High）

### 输出控制设置

1. **显示模型信息**：控制是否在输出中默认显示模型名称和时间戳
   - 启用时，输出中会包含类似 `[模型名称 (模型版本) 时间]` 的信息
   - 禁用时，输出中只显示 AI 生成的内容

2. **显示性能数据**：控制是否在输出中默认显示性能指标
   - 启用时，输出中会包含类似 `[Toks: 总数 ↑输入 ↓输出 生成速度toks/s | 首字延迟: XXms | 总耗时: XXms]` 的信息
   - 禁用时，输出中不显示任何性能数据

## 提示词模板系统

### 基本变量

1. **{{=SELECTION=}}**：插入选中的文本
2. **{{=CONTEXT=}}**：插入上下文内容
3. **{{=CURRENT_TIME=}}**：插入当前时间

### 条件控制

使用 `{{=CONTEXT_START=}}` 和 `{{=CONTEXT_END=}}` 来条件性地包含上下文。

### 输出格式控制

1. **{{=SHOW_MODEL_INFO=}}**：控制模型信息显示
   ```
   {{=SHOW_MODEL_INFO=}}=false
   翻译以下内容为英文：
   ```

2. **{{=SHOW_PERFORMANCE=}}**：控制性能数据显示
   ```
   {{=SHOW_PERFORMANCE=}}=false
   总结以下内容：
   ```

3. **同时使用多个控制变量**
   ```
   {{=SHOW_MODEL_INFO=}}=false
   {{=SHOW_PERFORMANCE=}}=false
   写一篇关于AI的短文：
   ```

## 控制优先级规则

在处理控制变量时，系统使用以下优先级规则：

1. 如果在系统提示词(System prompt)中设置了控制参数，优先使用系统提示词中的设置
2. 如果系统提示词中没有设置，则使用用户提示词中的设置
3. 如果两者都没有设置，则使用全局设置中的默认值

## 使用实例

### 例1：纯文本输出（无模型信息和性能数据）

```
{{=SHOW_MODEL_INFO=}}=false
{{=SHOW_PERFORMANCE=}}=false
请帮我总结这段文字：
```

输出示例：
```
这是AI生成的纯文本内容，没有任何模型信息或性能数据。
```

### 例2：只显示模型信息

```
{{=SHOW_MODEL_INFO=}}=true
{{=SHOW_PERFORMANCE=}}=false
分析以下内容：
```

输出示例：
```
[Ollama (gemma2) 2024-06-17 15:20:30]:
---
这是AI生成的内容，只包含模型信息，没有性能数据。
```

### 例3：只显示性能数据

```
{{=SHOW_MODEL_INFO=}}=false
{{=SHOW_PERFORMANCE=}}=true
翻译以下内容：
```

输出示例：
```
这是AI生成的内容，没有模型信息。

---
[Toks: 320 ↑150 ↓170 25toks/s | 首字: 420ms | 总耗时: 6800ms]:
```

### 例4：同时显示模型信息和性能数据

```
{{=SHOW_MODEL_INFO=}}=true
{{=SHOW_PERFORMANCE=}}=true
请写一篇短文：
```

输出示例：
```
[Ollama (gemma2) 2024-06-17 15:25:45]:
---
这是AI生成的内容，包含完整的模型信息和性能数据。

---
[Toks: 450 ↑120 ↓330 30toks/s | 首字: 380ms | 总耗时: 11000ms]:
```

## 常见问题

1. **为什么我设置了全局控制为false，但输出仍然显示模型信息和性能数据？**
   - 检查您的系统提示词或用户提示词中是否有覆盖全局设置的控制变量
   - 系统提示词的设置具有最高优先级

2. **如何在不同的动作中设置不同的显示选项？**
   - 在每个动作的提示词中使用相应的控制变量
   - 系统提示词中的设置会覆盖用户提示词中的设置

3. **为什么控制变量不起作用？**
   - 确保控制变量的格式正确：`{{=SHOW_MODEL_INFO=}}=true` 或 `{{=SHOW_MODEL_INFO=}}=false`
   - 确保控制变量位于提示词的开始部分
   - 多个控制变量应各占一行 